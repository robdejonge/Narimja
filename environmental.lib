#!/bin/bash

function convertTemperatureFromFahrenheitToCelcius () {

	echo "scale=$2; ($1-32)*5/9" | bc -l

}

# ----------------------------------------------------------------------------

function convertTemperatureFromCelciusToFahrenheit () {

	echo "scale=$2; $1*9/5+32" | bc -l

}

function calculateHeatIndex () {

	local temperature_c=$1
	local relative_humidity=$2
	local number_of_decimals_in_result=$3

	local temperature_f=`convertTemperatureFromCelciusToFahrenheit $temperature_c 9`
	local heatindex_f=`echo "(-42.379) + (2.04901523*$temperature_f) + (10.14333127*$relative_humidity) + (-0.22475541*$temperature_f*$relative_humidity) + (-6.83783*10^-3*$temperature_f^2) + (-5.481717*10^-2*$relative_humidity^2) + (1.22874*10^-3*$temperature_f^2*$relative_humidity) + (8.5282*10^-4*$temperature_f*$relative_humidity^2) + (-1.99*10^-6*$temperature_f^2*$relative_humidity^2)" | bc -l`
	local heatindex_c=`convertTemperatureFromFahrenheitToCelcius $heatindex_f $number_of_decimals_in_result`

	echo $heatindex_c

}

# ----------------------------------------------------------------------------

function addEnvironmentalData () {


	if [ $# -eq 5 ]; then 

		local location=$1
		local sensor=$2
		local posix_time=$3
		local temperature=$4
		local relative_humidity=$5

		print_debug "inserting location=$location, sensor=$sensor, posix_time=$posix_time, temperature=$temperature, relative humidity=$relative_humidity"

		dbquery $DEFAULT_DB "INSERT INTO data_environmental (location, sensor, posix_time, temperature, relative_humidity) VALUES ($location, $sensor, $posix_time, $temperature, $relative_humidity)"

	else 

		print_debug "incorrect number of parameters passed to $FUNCNAME()"

	fi 

}